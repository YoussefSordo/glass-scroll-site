<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Glass Scroll Effect</title>
<style>
  html, body {
    margin: 0;
    height: 4096px;   /* <-- scroll ends exactly at gradient bottom */
    background: black;
    overflow-x: hidden;
  }

  canvas {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
  }
</style>
</head>
<body>
<canvas id="scene"></canvas>

<script src="https://unpkg.com/three@0.160.0/build/three.min.js"></script>
<script>
const scene = new THREE.Scene();
const camera = new THREE.OrthographicCamera(-1, 1, 1, -1, 0, 1);

const renderer = new THREE.WebGLRenderer({
  canvas: document.getElementById('scene'),
  alpha: true
});
renderer.setSize(window.innerWidth, window.innerHeight);
renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));

const loader = new THREE.TextureLoader();

const gradient = loader.load("color_gradient_ultra_seamless.jpg");
const glass = loader.load("glass-lines.png");

gradient.wrapS = THREE.RepeatWrapping;
gradient.wrapT = THREE.RepeatWrapping;
glass.wrapS = THREE.RepeatWrapping;
glass.wrapT = THREE.RepeatWrapping;

const material = new THREE.ShaderMaterial({
  uniforms: {
    uTexture: { value: gradient },
    uGlass: { value: glass },
    uScroll: { value: 0 },
    uGlassScrollScale: { value: 0.18 },  // glass scroll slower
    uAspect: { value: window.innerWidth / window.innerHeight }
  },
  vertexShader: `
    varying vec2 vUv;
    void main() {
      vUv = uv;
      gl_Position = vec4(position, 1.0);
    }
  `,
  fragmentShader: `
    varying vec2 vUv;
    uniform sampler2D uTexture;
    uniform sampler2D uGlass;
    uniform float uScroll;
    uniform float uGlassScrollScale;
    uniform float uAspect;

    void main() {
      // Rotate gradient 90Â°
      vec2 gradUV = vec2(vUv.y, vUv.x);

      // Fit gradient to screen
      float imgAspect = 600.0 / 4096.0;
      if (uAspect > imgAspect) {
        gradUV.y = (gradUV.y - 0.5) * (uAspect / imgAspect) + 0.5;
      } else {
        gradUV.x = (gradUV.x - 0.5) * (imgAspect / uAspect) + 0.5;
      }

      // Scroll gradient
      gradUV.y += uScroll;

      // Glass (almost fixed, slow scroll)
      vec2 glassUV = vUv;
      glassUV.y += uScroll * uGlassScrollScale;

      float d = texture2D(uGlass, glassUV).r;
      vec2 displaced = gradUV + vec2(d * 0.15, 0.0);

      gl_FragColor = texture2D(uTexture, displaced);
    }
  `
});

const mesh = new THREE.Mesh(new THREE.PlaneGeometry(2, 2), material);
scene.add(mesh);

window.addEventListener("resize", () => {
  renderer.setSize(window.innerWidth, window.innerHeight);
  material.uniforms.uAspect.value = window.innerWidth / window.innerHeight;
});

window.addEventListener("scroll", () => {
  // Map scroll from 0 -> 4096px
  material.uniforms.uScroll.value = window.scrollY * 0.0006;
});

function animate() {
  requestAnimationFrame(animate);
  renderer.render(scene, camera);
}
animate();
</script>
</body>
</html>
